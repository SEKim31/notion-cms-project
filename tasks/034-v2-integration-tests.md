# Task 034: v2 기능 통합 테스트

## 개요

Phase 9(상태 동기화)와 Phase 10(이메일 자동 발송) 기능의 통합 테스트 및 회귀 테스트를 수행합니다.

## 목표

- 상태 동기화 E2E 테스트 케이스 검증
- 이메일 발송 플로우 E2E 테스트 케이스 추가
- 기존 테스트와의 회귀 테스트 수행

## 관련 파일

### 테스트 파일
- `e2e/status-sync.spec.ts` - 상태 동기화 테스트 (기존)
- `e2e/email.spec.ts` - 이메일 발송 테스트 (신규)
- `e2e/helpers/test-utils.ts` - 테스트 유틸리티

### 테스트 대상 API
- `app/api/quotes/[id]/send-email/route.ts` - 이메일 발송 API
- `app/api/sync/route.ts` - 동기화 API
- `app/api/quotes/route.ts` - 견적서 목록 API

### 테스트 대상 컴포넌트
- `components/features/quotes/send-email-dialog.tsx` - 이메일 발송 다이얼로그
- `components/features/quotes/quote-card.tsx` - 상태 배지

## 테스트 체크리스트

### 상태 동기화 테스트 (기존 검증)
- [x] 동기화 API가 인증 없이 401을 반환한다
- [x] 견적서 목록 API가 상태 필드를 포함한다
- [x] 견적서 상세 API가 상태 필드를 포함한다
- [x] QuoteStatus enum이 7개 상태를 지원한다
- [x] 한글 상태 라벨이 올바르게 정의되어 있다

### 이메일 발송 테스트 (신규)
- [x] 이메일 발송 API가 인증 없이 401을 반환한다
- [x] 이메일 발송 API가 GET 요청을 허용하지 않는다
- [x] 이메일 발송 API가 유효하지 않은 이메일 주소에 400을 반환한다
- [x] 이메일 발송 API가 존재하지 않는 견적서에 404를 반환한다
- [x] 이메일 발송 API가 유효하지 않은 UUID에 400을 반환한다

### 회귀 테스트
- [ ] 전체 테스트 스위트 실행 및 통과 확인
- [ ] 인증 플로우 테스트 통과
- [ ] 견적서 CRUD 테스트 통과
- [ ] PDF 다운로드 테스트 통과
- [ ] 공유 기능 테스트 통과

## 구현 단계

### 1단계: 이메일 발송 E2E 테스트 작성 - 완료
- `e2e/email.spec.ts` 파일 생성
- 이메일 발송 API 테스트 케이스 작성

### 2단계: 기존 테스트 검증 - 진행 중
- 전체 테스트 실행
- 실패하는 테스트 수정

### 3단계: 회귀 테스트 수행 - 대기
- npm run test:e2e 실행
- 모든 테스트 통과 확인

## 수락 기준

1. 모든 E2E 테스트가 통과해야 함
2. 이메일 발송 API 테스트 5개 이상 작성
3. 상태 동기화 테스트 5개 이상 존재
4. 회귀 테스트에서 기존 기능 정상 동작 확인
