# 노션 견적서 뷰어 v2 - 사용자 가이드

이 문서는 v2에서 추가된 **상태 동기화**와 **이메일 자동 발송** 기능의 사용 방법을 안내합니다.

---

## 목차

1. [견적서 상태 동기화](#1-견적서-상태-동기화)
2. [이메일 자동 발송](#2-이메일-자동-발송)
3. [FAQ](#3-faq)

---

## 1. 견적서 상태 동기화

### 개요

노션 데이터베이스의 상태(Status) 속성이 앱의 견적서 카드에 자동으로 반영됩니다.

### 지원하는 상태값

| 상태 | 배지 색상 | 설명 |
|------|----------|------|
| 작성 중 | 회색 | 견적서 작성 진행 중 |
| 작성완료 | 파란색 | 견적서 작성 완료 |
| 발송됨 | 초록색 | 클라이언트에게 발송 완료 |
| 조회됨 | 보라색 | 클라이언트가 견적서 확인 |
| 승인 | 초록색 | 클라이언트 승인 완료 |
| 거절 | 빨간색 | 클라이언트 거절 |
| 만료됨 | 주황색 | 유효기간 경과 |

### 사용 방법

1. **노션 데이터베이스 설정**
   - 노션에서 견적서 데이터베이스에 "상태" 또는 "Status" 속성(Select 타입) 추가
   - 위 표의 상태값 중 원하는 옵션 추가

2. **동기화 실행**
   - 앱의 견적서 목록 페이지에서 "동기화" 버튼 클릭
   - 노션의 상태값이 앱에 자동으로 반영됨

3. **상태별 필터링**
   - 견적서 목록 상단의 필터 드롭다운에서 상태 선택
   - 선택한 상태의 견적서만 표시

### 상태 자동 변경

다음 상황에서 상태가 자동으로 변경됩니다:

- **이메일 발송 시**: 상태가 "발송됨"으로 자동 변경
- **노션 동기화 시**: 노션의 상태값이 앱에 반영

---

## 2. 이메일 자동 발송

### 개요

견적서를 PDF로 첨부하여 클라이언트 이메일로 직접 발송할 수 있습니다.

### 사전 준비 (관리자)

이메일 발송 기능을 사용하려면 다음 환경 변수가 설정되어야 합니다:

```bash
# .env.local
RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxx
EMAIL_FROM=your-email@domain.com
```

### 사용 방법

1. **견적서 상세 페이지 접속**
   - 견적서 목록에서 발송할 견적서 클릭

2. **이메일 발송 버튼 클릭**
   - 상세 페이지 상단의 "이메일 발송" 버튼 클릭
   - 이메일 발송 다이얼로그가 열림

3. **발송 정보 입력**
   - **수신자 이메일**: 클라이언트 이메일 주소 (자동 채움됨)
   - **제목**: 이메일 제목 (기본값 제공)
   - **메시지**: 추가 메시지 (선택)

4. **발송하기**
   - "발송하기" 버튼 클릭
   - 발송 성공 시 토스트 메시지 표시
   - 견적서 상태가 "발송됨"으로 자동 변경

### 이메일 구성

발송되는 이메일에는 다음 내용이 포함됩니다:

- **본문**: 견적서 요약 정보 (회사명, 견적번호, 총액 등)
- **첨부파일**: 견적서 PDF 파일
- **공유 링크**: 웹에서 견적서를 확인할 수 있는 링크

### 발송 이력 확인

- 견적서 상세 페이지 헤더에 발송 이력 표시
- 발송 일시와 수신자 이메일 확인 가능

---

## 3. FAQ

### Q: 노션에서 상태를 변경했는데 앱에 반영이 안 돼요

**A**: 동기화 버튼을 클릭하여 수동으로 동기화를 실행해주세요. 현재 버전에서는 자동 실시간 동기화를 지원하지 않습니다.

### Q: 이메일 발송이 실패해요

**A**: 다음 사항을 확인해주세요:
- 환경 변수(`RESEND_API_KEY`, `EMAIL_FROM`)가 올바르게 설정되었는지 확인
- 수신자 이메일 주소가 유효한지 확인
- Resend 대시보드에서 발송 한도를 확인

### Q: 이메일 발송 후 상태가 변경되지 않아요

**A**: 이메일 발송이 성공하면 상태가 자동으로 "발송됨"으로 변경됩니다. 변경되지 않는다면:
- 페이지를 새로고침해보세요
- 동기화 버튼을 클릭해보세요

### Q: 발송된 이메일을 다시 보낼 수 있나요?

**A**: 네, 같은 견적서를 여러 번 발송할 수 있습니다. 매번 발송 시 최신 정보가 반영됩니다.

### Q: 상태 옵션을 커스터마이즈할 수 있나요?

**A**: 현재 버전에서는 위에 나열된 7가지 상태만 지원합니다. 노션에서 다른 이름을 사용하면 자동으로 매핑되지 않습니다.

---

## 관련 문서

- [배포 가이드](./DEPLOYMENT.md)
- [API 문서](./API.md)
- [개발 로드맵](./ROADMAP.md)
