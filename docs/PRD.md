# 노션 견적서 뷰어 MVP PRD

## 🎯 핵심 정보

**목적**: 노션에서 작성한 견적서를 클라이언트가 웹에서 확인하고 PDF로 다운로드할 수 있는 시스템
**사용자**: 견적서를 발행하는 사업자와 견적서를 받아보는 클라이언트

## 🚶 사용자 여정

### 사업자 플로우
1. **노션 데이터베이스**
   ↓ 견적서 작성 및 저장

2. **노션 API 자동 동기화**
   ↓ 백그라운드에서 자동으로 데이터 가져오기

3. **견적서 목록 페이지**
   ↓ 발행된 견적서 확인 및 공유 링크 복사

4. **클라이언트에게 링크 전달** (이메일, 메시지 등)

### 클라이언트 플로우
1. **공유 링크 접속**
   ↓ 고유 URL로 직접 접근

2. **견적서 상세 페이지**
   - 견적서 내용 웹에서 확인
   - 회사 정보, 품목, 금액 등 표시
   ↓ [PDF 다운로드] 버튼 클릭

3. **PDF 파일 생성 및 다운로드**
   ↓ 브라우저에서 파일 다운로드

4. **완료** → 저장된 PDF 파일 확인 가능

---

## ⚡ 기능 명세

### 1. MVP 핵심 기능

| ID | 기능명 | 설명 | MVP 필수 이유 | 관련 페이지 |
|----|--------|------|-------------|------------|
| **F001** | 노션 API 연동 | 노션 데이터베이스에서 견적서 데이터 조회 | 데이터 소스의 핵심 | 견적서 목록 페이지, 견적서 상세 페이지 |
| **F002** | 견적서 목록 조회 | 발행된 모든 견적서를 목록으로 표시 | 사업자의 견적서 관리 | 견적서 목록 페이지 |
| **F003** | 견적서 상세 보기 | 개별 견적서의 전체 내용을 웹에서 표시 | 클라이언트의 핵심 니즈 | 견적서 상세 페이지, 공유 견적서 페이지 |
| **F004** | PDF 다운로드 | 견적서를 PDF 파일로 변환 및 다운로드 | 오프라인 보관 및 인쇄 필요 | 견적서 상세 페이지, 공유 견적서 페이지 |
| **F005** | 공유 링크 생성 | 클라이언트가 접근할 수 있는 고유 URL 생성 | 비로그인 사용자 접근 허용 | 견적서 목록 페이지, 견적서 상세 페이지 |

### 2. MVP 필수 지원 기능

| ID | 기능명 | 설명 | MVP 필수 이유 | 관련 페이지 |
|----|--------|------|-------------|------------|
| **F010** | 기본 인증 | 사업자용 회원가입/로그인/로그아웃 | 사업자 페이지 접근 제어 | 로그인 페이지, 회원가입 페이지 |
| **F011** | 노션 연동 설정 | 노션 API 키 및 데이터베이스 ID 저장 | 노션 데이터 접근 권한 관리 | 설정 페이지 |
| **F012** | 데이터 동기화 | 노션 데이터베이스와 수동/자동 동기화 | 최신 견적서 정보 반영 | 견적서 목록 페이지 |

### 3. MVP 이후 기능 (제외)

- 견적서 작성 기능 (노션에서 직접 작성)
- 견적서 수정/삭제 (노션에서 관리)
- 클라이언트 회원가입 및 로그인
- 견적서 승인/거절 워크플로우
- 이메일 자동 발송
- 결제 연동
- 다국어 지원
- 템플릿 커스터마이징
- 통계 대시보드

---

## 📱 메뉴 구조

```
📱 견적서 뷰어 내비게이션

👤 비로그인 사용자
├── 🏠 홈 (랜딩)
└── 🔑 인증
    ├── 로그인 - F010
    └── 회원가입 - F010

💼 사업자 메뉴 (로그인 후)
├── 📋 견적서 목록
│   └── 기능: F002 (견적서 목록 조회), F005 (공유 링크 생성), F012 (데이터 동기화)
├── ⚙️ 설정
│   └── 기능: F011 (노션 연동 설정)
└── 🚪 로그아웃 - F010

🔗 공유 링크 (인증 불필요)
└── 📄 견적서 보기 (고유 URL)
    └── 기능: F003 (견적서 상세 보기), F004 (PDF 다운로드)
```

---

## 📄 페이지별 상세 기능

### 홈 (랜딩 페이지)

> **구현 기능:** - | **메뉴 위치:** 최상위

| 항목 | 내용 |
|------|------|
| **역할** | 서비스 소개 및 사업자 로그인 유도 |
| **진입 경로** | 최초 접속 시 기본 페이지 |
| **사용자 행동** | 서비스 설명 확인 후 로그인/회원가입 선택 |
| **주요 기능** | • 서비스 주요 기능 소개<br>• **로그인** 버튼<br>• **회원가입** 버튼 |
| **다음 이동** | 로그인 페이지 또는 회원가입 페이지 |

---

### 로그인 페이지

> **구현 기능:** `F010` | **메뉴 위치:** 인증

| 항목 | 내용 |
|------|------|
| **역할** | 사업자 계정 인증 |
| **진입 경로** | 홈에서 로그인 버튼 클릭, 또는 보호된 페이지 접근 시 자동 리디렉션 |
| **사용자 행동** | 이메일/비밀번호 입력 후 로그인 |
| **주요 기능** | • 이메일 입력 필드<br>• 비밀번호 입력 필드<br>• **로그인** 버튼<br>• 회원가입 페이지 링크 |
| **다음 이동** | 성공 → 견적서 목록 페이지, 실패 → 에러 메시지 표시 |

---

### 회원가입 페이지

> **구현 기능:** `F010` | **메뉴 위치:** 인증

| 항목 | 내용 |
|------|------|
| **역할** | 사업자 계정 생성 |
| **진입 경로** | 홈 또는 로그인 페이지에서 회원가입 버튼 클릭 |
| **사용자 행동** | 사업자 정보 입력 후 계정 생성 |
| **주요 기능** | • 이메일 입력 및 중복 검사<br>• 비밀번호 입력 및 확인<br>• 사업자명 입력<br>• **회원가입** 버튼 |
| **다음 이동** | 성공 → 로그인 페이지, 실패 → 에러 메시지 표시 |

---

### 견적서 목록 페이지

> **구현 기능:** `F002`, `F005`, `F012` | **인증:** 사업자 로그인 필수

| 항목 | 내용 |
|------|------|
| **역할** | 노션에서 가져온 전체 견적서 목록 관리 허브 |
| **진입 경로** | 로그인 성공 후 기본 랜딩 페이지, 헤더 메뉴의 견적서 목록 클릭 |
| **사용자 행동** | 견적서 목록 확인, 개별 견적서 상세 보기, 공유 링크 복사, 수동 동기화 |
| **주요 기능** | • 노션 데이터베이스에서 가져온 견적서 카드 목록<br>• 각 카드: 견적서 번호, 클라이언트명, 금액, 작성일 표시<br>• **견적서 상세 보기** 링크<br>• **공유 링크 복사** 버튼<br>• **노션 동기화** 버튼 (수동 동기화) |
| **다음 이동** | 견적서 클릭 → 견적서 상세 페이지 |

---

### 견적서 상세 페이지 (사업자용)

> **구현 기능:** `F001`, `F003`, `F004`, `F005` | **인증:** 사업자 로그인 필수

| 항목 | 내용 |
|------|------|
| **역할** | 사업자가 특정 견적서의 전체 내용 확인 및 관리 |
| **진입 경로** | 견적서 목록에서 개별 견적서 클릭 |
| **사용자 행동** | 견적서 내용 확인, PDF 다운로드, 공유 링크 복사 |
| **주요 기능** | • 견적서 헤더 (회사명, 로고, 견적서 번호, 작성일, 유효기간)<br>• 클라이언트 정보 (회사명, 담당자, 연락처)<br>• 품목 테이블 (품목명, 수량, 단가, 금액)<br>• 총합계 금액<br>• 비고/특이사항<br>• **PDF 다운로드** 버튼<br>• **공유 링크 복사** 버튼 |
| **다음 이동** | 목록으로 돌아가기 → 견적서 목록 페이지 |

---

### 공유 견적서 페이지 (클라이언트용)

> **구현 기능:** `F003`, `F004` | **인증:** 불필요 (공개 링크)

| 항목 | 내용 |
|------|------|
| **역할** | 클라이언트가 공유 링크로 견적서 확인 및 PDF 다운로드 |
| **진입 경로** | 사업자가 전달한 고유 공유 URL 접속 (예: `/quote/share/[shareId]`) |
| **사용자 행동** | 견적서 내용 확인 후 필요시 PDF 다운로드 |
| **주요 기능** | • 견적서 헤더 (회사명, 로고, 견적서 번호, 작성일, 유효기간)<br>• 클라이언트 정보 (회사명, 담당자, 연락처)<br>• 품목 테이블 (품목명, 수량, 단가, 금액)<br>• 총합계 금액<br>• 비고/특이사항<br>• **PDF 다운로드** 버튼 |
| **다음 이동** | 페이지 종료 (외부 사용자이므로 다른 페이지 이동 없음) |

---

### 설정 페이지

> **구현 기능:** `F011` | **인증:** 사업자 로그인 필수

| 항목 | 내용 |
|------|------|
| **역할** | 노션 API 연동 설정 및 사업자 정보 관리 |
| **진입 경로** | 헤더 메뉴의 설정 클릭 |
| **사용자 행동** | 노션 API 키 및 데이터베이스 ID 입력/수정 |
| **주요 기능** | • 노션 API 키 입력 필드<br>• 노션 데이터베이스 ID 입력 필드<br>• 연동 상태 확인 (연결 성공/실패)<br>• **저장** 버튼<br>• **연동 테스트** 버튼 |
| **다음 이동** | 저장 성공 → 견적서 목록 페이지로 자동 동기화 유도 |

---

## 🗄️ 데이터 모델

### User (사업자 계정)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| email | 로그인 이메일 | String (unique) |
| password | 암호화된 비밀번호 | String (hashed) |
| companyName | 사업자명/회사명 | String |
| notionApiKey | 노션 API 키 (암호화 저장) | String (encrypted) |
| notionDatabaseId | 노션 데이터베이스 ID | String |
| createdAt | 계정 생성일 | DateTime |
| updatedAt | 정보 수정일 | DateTime |

### Quote (견적서)
| 필드 | 설명 | 타입/관계 |
|------|------|----------|
| id | 고유 식별자 | UUID |
| userId | 사업자 ID | → User.id |
| notionPageId | 노션 페이지 ID (원본 연결) | String (unique) |
| quoteNumber | 견적서 번호 | String |
| clientName | 클라이언트 회사명 | String |
| clientContact | 클라이언트 담당자 | String |
| clientPhone | 클라이언트 연락처 | String |
| items | 품목 목록 (JSON) | JSON Array |
| totalAmount | 총 금액 | Number |
| issueDate | 발행일 | Date |
| validUntil | 유효기간 | Date |
| notes | 비고/특이사항 | Text |
| shareId | 공유 링크 고유 ID | String (unique) |
| createdAt | 데이터 생성일 | DateTime |
| updatedAt | 마지막 동기화 시간 | DateTime |

### QuoteItem (품목 상세 - Quote.items JSON 구조)
| 필드 | 설명 | 타입 |
|------|------|------|
| name | 품목명 | String |
| quantity | 수량 | Number |
| unitPrice | 단가 | Number |
| amount | 금액 (수량 × 단가) | Number |
| description | 품목 설명 | String |

---

## 🛠️ 기술 스택 (최신 버전)

### 🎨 프론트엔드 프레임워크
- **Next.js 16** (App Router) - React 풀스택 프레임워크
- **TypeScript 5.6+** - 타입 안전성 보장
- **React 19** - UI 라이브러리 (최신 동시성 기능)

### 🎨 스타일링 & UI
- **TailwindCSS v4** (설정파일 없는 새로운 엔진) - 유틸리티 CSS 프레임워크
- **shadcn/ui** - 고품질 React 컴포넌트 라이브러리
- **Lucide React** - 아이콘 라이브러리

### 📝 폼 & 검증
- **React Hook Form 7.x** - 폼 상태 관리
- **Zod** - 스키마 검증 라이브러리

### 🗄️ 백엔드 & 데이터베이스
- **Supabase** - BaaS (인증, 데이터베이스, 실시간 구독)
- **PostgreSQL** - 관계형 데이터베이스 (Supabase 포함)

### 🔌 외부 연동
- **@notionhq/client** - Notion API 공식 SDK
- **Notion API** - 데이터베이스 조회 및 페이지 읽기

### 📄 PDF 생성
- **react-pdf/renderer** - React 컴포넌트로 PDF 생성
- **jsPDF** (대안) - 브라우저에서 PDF 생성

### 🚀 배포 & 호스팅
- **Vercel** - Next.js 16 최적화 배포 플랫폼

### 📦 패키지 관리
- **npm** - 의존성 관리

---

## 📋 구현 우선순위 (개발 가이드)

### Phase 1: 기본 인프라 (1-2일)
1. Next.js 16 프로젝트 초기 설정 (이미 완료)
2. Supabase 연동 및 User 테이블 생성
3. 기본 인증 (F010) - 회원가입/로그인/로그아웃

### Phase 2: 노션 연동 (2-3일)
1. Notion API 클라이언트 설정
2. 설정 페이지 (F011) - API 키 저장
3. 노션 데이터베이스 스키마 매핑
4. 데이터 동기화 (F012) - 수동 동기화 먼저 구현

### Phase 3: 견적서 조회 (2-3일)
1. Quote 데이터 모델 및 DB 테이블 생성
2. 견적서 목록 페이지 (F002)
3. 견적서 상세 페이지 (F003) - 사업자용

### Phase 4: 공유 기능 (1-2일)
1. 공유 링크 생성 (F005) - shareId 생성 로직
2. 공유 견적서 페이지 (F003) - 클라이언트용 공개 페이지

### Phase 5: PDF 생성 (2-3일)
1. react-pdf/renderer로 견적서 템플릿 작성
2. PDF 다운로드 (F004) - 서버 사이드 렌더링 또는 클라이언트 사이드

### Phase 6: 테스트 및 배포 (1-2일)
1. 통합 테스트
2. Vercel 배포
3. 실제 노션 데이터베이스 연동 테스트

**총 예상 개발 기간: 9-15일**

---

## ✅ 정합성 검증 체크리스트

### 🔍 1단계: 기능 명세 → 페이지 연결 검증
- [x] F001 (노션 API 연동) → 견적서 목록 페이지, 견적서 상세 페이지 ✓
- [x] F002 (견적서 목록 조회) → 견적서 목록 페이지 ✓
- [x] F003 (견적서 상세 보기) → 견적서 상세 페이지, 공유 견적서 페이지 ✓
- [x] F004 (PDF 다운로드) → 견적서 상세 페이지, 공유 견적서 페이지 ✓
- [x] F005 (공유 링크 생성) → 견적서 목록 페이지, 견적서 상세 페이지 ✓
- [x] F010 (기본 인증) → 로그인 페이지, 회원가입 페이지 ✓
- [x] F011 (노션 연동 설정) → 설정 페이지 ✓
- [x] F012 (데이터 동기화) → 견적서 목록 페이지 ✓

### 🔍 2단계: 메뉴 구조 → 페이지 연결 검증
- [x] 홈 → 홈 페이지 존재 ✓
- [x] 로그인 → 로그인 페이지 존재 ✓
- [x] 회원가입 → 회원가입 페이지 존재 ✓
- [x] 견적서 목록 → 견적서 목록 페이지 존재 ✓
- [x] 설정 → 설정 페이지 존재 ✓
- [x] 공유 링크 견적서 보기 → 공유 견적서 페이지 존재 ✓

### 🔍 3단계: 페이지별 상세 기능 → 역참조 검증
- [x] 모든 페이지의 구현 기능 ID가 기능 명세에 정의됨 ✓
- [x] 모든 페이지가 메뉴 구조에서 접근 가능 ✓

### 🔍 4단계: 누락 및 고아 항목 검증
- [x] 기능 명세의 모든 기능이 최소 1개 이상의 페이지에서 구현됨 ✓
- [x] 페이지에서 참조하는 모든 기능 ID가 기능 명세에 존재 ✓
- [x] 메뉴의 모든 항목이 페이지별 상세 기능에 존재 ✓

**✅ 정합성 검증 통과**

---

## 🎯 성공 지표 (MVP 검증)

1. **기술적 성공**
   - 노션 데이터베이스에서 견적서 데이터 조회 성공률 100%
   - PDF 다운로드 성공률 95% 이상
   - 페이지 로딩 시간 3초 이내

2. **사용자 성공**
   - 사업자가 견적서 목록을 확인하고 공유 링크 생성 가능
   - 클라이언트가 공유 링크로 견적서 확인 및 PDF 다운로드 가능
   - 최소 3명 이상의 베타 사용자 확보

3. **비즈니스 성공**
   - 1주일 내에 실제 비즈니스 견적서 5건 이상 발행
   - 클라이언트 피드백 수집 (PDF 품질, 레이아웃 만족도)

---

## 📝 주요 기술적 고려사항

### 노션 API 연동
- Notion API는 데이터베이스 쿼리 시 페이지네이션 지원 (100개 단위)
- 노션 페이지 속성과 DB 스키마 매핑 필요
- Rate Limit: 초당 3 requests (캐싱 전략 필요)

### PDF 생성 전략
- **서버 사이드**: react-pdf/renderer로 서버에서 생성 후 다운로드
- **클라이언트 사이드**: jsPDF로 브라우저에서 직접 생성 (더 빠름)
- 한글 폰트 임베딩 필수

### 보안
- 노션 API 키는 암호화하여 DB 저장
- 공유 링크는 UUID 기반 난수 생성으로 추측 불가능하게
- 환경 변수로 민감 정보 관리 (NOTION_API_KEY 등)

### 성능 최적화
- 견적서 목록은 React Query로 캐싱
- 노션 데이터는 DB에 저장 후 주기적 동기화 (실시간 X)
- PDF 생성은 로딩 인디케이터 표시 (3-5초 소요 가능)
